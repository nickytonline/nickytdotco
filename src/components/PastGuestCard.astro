---
import type { StreamGuestInfo } from "../utils/schedule-utils";
import { getLocalizedDate } from "../utils/schedule-utils";
import { getYouTubeId } from "../utils/youtube-utils";

interface Props {
  guest: StreamGuestInfo;
  locale: string;
  timezone: string;
}

const { guest, locale, timezone } = Astro.props;

const {
  date,
  title,
  guestName,
  guestTitle,
  youtubeStreamLink,
} = guest;

const guestDate = getLocalizedDate({
  date,
  locale,
  timezone,
  showTime: false,
});

const videoId = youtubeStreamLink ? getYouTubeId(youtubeStreamLink) : null;
const image = videoId
  ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`
  : undefined;

const guestInfo = `Guest: ${guestName}${guestTitle ? `, ${guestTitle}` : ""}`;
---

<div class="past-guest-card flex flex-col md:flex-row gap-6" data-pagefind-ignore>
  {
    image && youtubeStreamLink && (
      <a
        href={youtubeStreamLink}
        target="_blank"
        rel="noopener noreferrer"
        class="relative shrink-0 w-full md:w-40 h-50 md:h-40 rounded-xl overflow-hidden hover:opacity-90 transition-opacity"
      >
        <img
          src={image}
          alt={`Watch ${title}`}
          class="w-full h-full object-cover object-center"
        />
        <div class="absolute inset-0 flex items-center justify-center">
          <svg
            class="w-16 h-16 text-white opacity-90"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path d="M8 5v14l11-7z" />
          </svg>
        </div>
      </a>
    )
  }
  <div class="flex-1 flex flex-col gap-3">
    <h3 class="text-2xl font-bold leading-tight text-foreground">
      {
        youtubeStreamLink ? (
          <a
            href={youtubeStreamLink}
            target="_blank"
            rel="noopener noreferrer"
            class="hover:text-pink-600 dark:hover:text-pink-400 transition-colors"
          >
            {title}
          </a>
        ) : (
          title
        )
      }
    </h3>
    <p class="text-lg text-muted-foreground">{guestInfo}</p>
    <time class="italic text-base text-muted-foreground font-medium"
      >{guestDate}</time
    >
    {
      youtubeStreamLink && (
        <div class="flex items-center gap-3 mt-auto">
          <a
            href={youtubeStreamLink}
            class="text-base text-foreground underline font-medium hover:text-pink-600 focus:text-pink-600 dark:hover:text-pink-400 dark:focus:text-pink-400 outline-none"
            target="_blank"
            rel="noopener noreferrer"
          >
            Watch on YouTube
          </a>
        </div>
      )
    }
  </div>
</div>
