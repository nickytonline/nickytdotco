---
interface Props {
  videoId: string;
  startTime?: string;
  loading?: "lazy" | "eager";
  title?: string;
}

const { videoId, startTime, loading = "lazy", title: providedTitle } = Astro.props;

// Use provided title or fetch from YouTube oEmbed API
let title = providedTitle || "YouTube Video";
if (!providedTitle) {
  try {
    const response = await fetch(
      `https://www.youtube.com/oembed?url=http://www.youtube.com/watch?v%3D${videoId}&format=json`
    );

    if (response.ok) {
      const data = await response.json();
      title = data.title;
    }
  } catch (error) {
    console.error(`Failed to fetch YouTube title for ${videoId}:`, error);
  }
}

const timeQueryParameter = startTime ? `?start=${startTime}` : "";
const url = `https://www.youtube.com/embed/${videoId}${timeQueryParameter}`;
---

<div class="w-full max-w-4xl mx-auto" style="min-height: 315px;">
  <div
    class="relative w-full rounded-lg overflow-hidden bg-secondary"
    style="padding-bottom: 56.25%; min-height: 315px;"
  >
    <iframe
      title={title}
      loading={loading}
      src={url}
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen
      referrerpolicy="strict-origin-when-cross-origin"
      class="absolute inset-0 w-full h-full bg-black rounded-lg"
      width="560"
      height="315"></iframe>
  </div>
</div>
