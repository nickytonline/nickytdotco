---
interface Props {
  videoId: string;
  startTime?: string;
}

const { videoId, startTime } = Astro.props;

// Fetch video title from YouTube oEmbed API
let title = "YouTube Video";
try {
  const response = await fetch(
    `https://www.youtube.com/oembed?url=http://www.youtube.com/watch?v%3D${videoId}&format=json`
  );

  if (response.ok) {
    const data = await response.json();
    title = data.title;
  }
} catch (error) {
  console.error(`Failed to fetch YouTube title for ${videoId}:`, error);
}

const timeQueryParameter = startTime ? `?start=${startTime}` : "";
const url = `https://www.youtube.com/embed/${videoId}${timeQueryParameter}`;
---

<div class="relative w-full max-w-4xl mx-auto aspect-video">
  <iframe
    title={title}
    loading="lazy"
    src={url}
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    allowfullscreen
    referrerpolicy="strict-origin-when-cross-origin"
    class="absolute inset-0 w-full h-full"
    width="560"
    height="315"></iframe>
</div>
