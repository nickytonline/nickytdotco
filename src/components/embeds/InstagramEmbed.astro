---
interface Props {
  url: string;
}

const { url } = Astro.props;

let instagramUrl: URL;

if (url.startsWith("http")) {
  instagramUrl = new URL(url);
} else {
  instagramUrl = new URL(url, "https://www.instagram.com/p/");
}
---

<blockquote
  class="instagram-media"
  data-instgrm-permalink={instagramUrl.toString()}
  data-instgrm-version="14"
>
  <a href={url}>View this post on Instagram</a>
</blockquote>
<script>
  const scriptSrc = "//www.instagram.com/embed.js";
  if (!document.querySelector(`script[src*="instagram.com/embed.js"]`)) {
    const script = document.createElement("script");
    script.async = true;
    script.src = scriptSrc;
    document.head.appendChild(script);
  } else if ((window as any).instgrm) {
    // Re-process embeds if script already loaded
    (window as any).instgrm.Embeds.process();
  }
</script>
