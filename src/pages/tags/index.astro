---
import { getCollection } from "astro:content";
import Layout from "../../layouts/MainLayout.astro";
import SectionHeader from "../../components/SectionHeader.astro";
import Tag from "@/components/Tag.astro";
export const prerender = true;

const talks = await getCollection("talks");

// Extract all unique tags and count their occurrences
const tagCounts = new Map<string, number>();
const tagToOriginalCase = new Map<string, string>();

talks.forEach((talk) => {
  if (talk.data.tags) {
    talk.data.tags.forEach((tag) => {
      const normalizedTag = tag.toLowerCase().replace(/\s+/g, "");
      tagCounts.set(normalizedTag, (tagCounts.get(normalizedTag) || 0) + 1);
      tagToOriginalCase.set(normalizedTag, tag);
    });
  }
});

// Sort tags by frequency (most frequent first)
const sortedTags = Array.from(tagCounts.entries()).sort((a, b) => b[1] - a[1]);

// Create alphabetical list for alphabetical view
const alphabeticalTags = [...sortedTags].sort((a, b) =>
  a[0].localeCompare(b[0])
);
---

<Layout title="Talk Tags | Nick Taylor">
  <main id="main" tabindex="-1" class="max-w-5xl mx-auto px-6 py-12">
    <div class="mb-12">
      <SectionHeader title="Talk Tags" />
      <p class="text-xl text-gray-600 mt-6">
        Explore talks by topic â€” from web development and AI to developer
        tooling and beyond.
      </p>
    </div>

    <div class="space-y-16">
      <section>
        <div
          class="mb-8 pb-1 border-l-4 border-pink-600 pl-6 bg-linear-to-r from-rose-50 to-transparent flex items-center"
        >
          <div>
            <h2 class="text-3xl font-bold text-gray-900">Popular Tags</h2>
            <p class="text-gray-600 mt-2">Most frequently used topics</p>
          </div>
        </div>
        <div class="flex flex-wrap gap-3">
          {
            sortedTags
              .slice(0, 10)
              .map(([tag, count]) => (
                <Tag tag={tag} count={count} variant="muted" />
              ))
          }
        </div>
      </section>

      <section>
        <div
          class="mb-8 pb-1 border-l-4 border-pink-600 pl-6 bg-linear-to-r from-rose-50 to-transparent flex items-center"
        >
          <div>
            <h2 class="text-3xl font-bold text-gray-900">All Tags</h2>
            <p class="text-gray-600 mt-2">
              {alphabeticalTags.length} topics in alphabetical order
            </p>
          </div>
        </div>
        <div class="flex flex-wrap gap-3">
          {
            alphabeticalTags.map(([tag, count]) => (
              <Tag tag={tag} count={count} variant="muted" />
            ))
          }
        </div>
      </section>

      {
        sortedTags.length === 0 && (
          <div class="text-center py-12">
            <p class="text-xl text-gray-500">No tags found.</p>
          </div>
        )
      }
    </div>
  </main>
</Layout>
