---
import { getCollection } from "astro:content";
import Layout from "../layouts/MainLayout.astro";
import SectionHeader from "../components/SectionHeader.astro";
import { dateFilter } from "../utils/filters";
export const prerender = true;

const talks = await getCollection("talks");
const sortedTalks = talks.sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

const talksByYear = sortedTalks.reduce(
  (acc, talk) => {
    const year = talk.data.date.getFullYear();
    if (!acc[year]) {
      acc[year] = [];
    }
    acc[year].push(talk);
    return acc;
  },
  {} as Record<number, typeof sortedTalks>
);

const years = Object.keys(talksByYear)
  .map(Number)
  .sort((a, b) => b - a);
---

<Layout
  title="Talks | Nick Taylor"
  socialImage="/assets/images/page-og/talks.jpg"
>
  <div class="mb-6">
    <SectionHeader title="Talks" headingLevel={1} />
    <p class="text-xl text-muted-foreground mt-6">
      Conference talks, meetups, and presentations about web development, AI,
      and developer tooling.
    </p>
    <div class="mt-6">
      <a
        href="/tags/talks/"
        class="inline-flex items-center gap-2 text-lg font-semibold text-foreground hover:text-pink-600 dark:hover:text-pink-400"
      >
        Browse by tag<span class="text-2xl">→</span>
      </a>
    </div>
  </div>

  <div class="space-y-12">
    {
      years.map((year) => (
        <div id={`year-${year}`} class="scroll-mt-24">
          <div class="mb-6 py-3 border-l-4 border-pink-600 dark:border-pink-400 pl-6 bg-linear-to-r from-rose-50 dark:from-pink-900/20 to-transparent flex items-center">
            <h2 class="text-4xl font-bold text-foreground leading-none">
              {year}
            </h2>
          </div>

          <div class="space-y-1" data-pagefind-ignore>
            {talksByYear[year].map((talk) => {
              const slug = talk.slug;
              return (
                <div class="py-5 px-6">
                  <div class="flex items-baseline justify-between gap-6">
                    <div class="flex-1">
                      <h3 class="text-xl font-bold">
                        <a
                          href={`/talks/${slug}`}
                          class="text-foreground hover:text-pink-600 hover:underline focus:text-pink-600 focus:underline dark:hover:text-pink-400 dark:focus:text-pink-400 focus:outline-none"
                        >
                          {talk.data.title}
                        </a>
                      </h3>
                      <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-4 text-muted-foreground mt-2">
                        <span class="text-base font-semibold text-pink-600 dark:text-pink-400">
                          {talk.data.venue.name}
                        </span>
                        <span class="hidden sm:inline text-pink-600 dark:text-pink-400 font-semibold">
                          •
                        </span>
                        <span class="italic text-base">
                          {dateFilter(talk.data.date)}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      ))
    }
  </div>
</Layout>
